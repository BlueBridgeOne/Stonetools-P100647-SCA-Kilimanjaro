define('RegisterCAA.View', [
  'Backbone',
  'register_caa.tpl',
  'underscore',
  'SC.Configuration',
  'RegisterCAA.Form.LC.View',
  'RegisterCAA.Form.LC.Model',
  'RegisterCAA.Form.ST.View',
  'RegisterCAA.Form.ST.Model'
], function (
  Backbone,
  RegisterCAATpl,
  _, 
  Configuration,
  FormLCView,
  FormLCModel,
  FormSTView,
  FormSTModel
) {
  'use strict';

  return Backbone.View.extend({

    attributes: {
      'class': 'contactus'
    },

    events: {
      'click .accordion-grey': 'showAccordion',
    },

    getBreadcrumbPages: function () {
      return [{
        text: _('Register CAA Application').translate(),
        href: '/revistercaa-application'
      }]
    },

    initialize: function (options) {
      console.log('RegisterCAA View initialized');

      this.childViewFormLC = new FormLCView({
        application: options.application,
        model: new FormLCModel()
      });
      this.childViewFormST = new FormSTView({
        application: options.application,
        model: new FormSTModel()
      });
    },

    template: RegisterCAATpl,

    getTitle: function () {
      return SC.Tools.getTitle("Register CAA Application");
    },

    getMetaDescription: function () {
      return "Use this Form to apply for a credit account.";
    },

    getAddToHead: function () {
      return SC.Tools.getSEO({
        title: "Register CAA Application",
        summary: this.getMetaDescription()
      });
    },

    showAccordion: function (e) {
      e.preventDefault();
      var $acc = $(e.target);

      if (!$acc.hasClass("accordion-grey")) {
        $acc = $acc.closest(".accordion-grey");
      }
      $acc.toggleClass("accordionactive");
      $acc = $acc.next();
      $acc.slideToggle();
    },

    render: function () {
      console.log('rendering view');
      this.$el.html(this.template());
      this.$el.find('.contactus-lc-accordion').append(this.childViewFormLC.render().el);
      this.$el.find('.contactus-st-accordion').append(this.childViewFormST.render().el);
    }

  });
});