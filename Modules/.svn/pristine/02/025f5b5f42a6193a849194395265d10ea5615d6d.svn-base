/* BB1 G Truslove 2015 */

define('Sidebar.List.View', [
	'Backbone', 'sidebar_list.tpl', 'Backbone.CollectionView', 'Backbone.CompositeView', 'Sidebar.Details.View', 'ArticleOverview.Model',
	'Sidebar.Collection', 'SC.Configuration', 'Article'
], function(Backbone, sidebar_list_tpl, CollectionView, CompositeView, SidebarDetailsView, Model, Collection, Configuration, Article) {
	return Backbone.View.extend({
		initialize: function(options) {
			CompositeView.add(this);
			this.application = options.application;
			this.types = options.types;
			if (options.collection) {
				this.collection = options.collection;
			} else {
				var self = this;
				self.application = options.application;
				self.collection = new Collection();
				self.collection.fetch({
					data: {
						language: Article.getLanguage(),
						types: this.types ? this.types.join(',') : undefined
					}
				}).done(function(data) {
					self.collection = new Collection(data);
					self.render();
				});
			}
		},
		events: {
				'click .accordion-grey': 'showAccordion'
			},
			showAccordion: function(e) {
				e.preventDefault();
				var $acc = $(e.target);

				if (!$acc.hasClass("accordion-grey")) {
					$acc = $acc.closest(".accordion-grey");
				}
				$acc.toggleClass("accordionactive");

				$acc.next().slideToggle();


			},
		childViews: {
			'Sidebar.Collection': function() {
				return new CollectionView({
					'childView': SidebarDetailsView,
					'collection': this.collection
				});
			}
		},

		template: sidebar_list_tpl,

		getContext: function() { //Collate all the information together for the sidebar.
			return this.collection;
		}
	});
});