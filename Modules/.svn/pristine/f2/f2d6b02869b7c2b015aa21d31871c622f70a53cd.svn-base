/* BB1 G Truslove - reusable functions */

define('Tools', [
		'jQuery', 'Utils', 'underscore', 'SC.Configuration'
	],
	function(
		jQuery, Utils, _, Configuration
	) {

		'use strict';

		function trim(text){ //trim leading and ending spaces
		return text.replace(/^\s+|\s+$/g, '')
		}

		function getInitials(text) { //Get the initials of this name for the header.
			if (!text) {
				return;
			}
			var names = text.split(" ");
			if (names.length == 1) {
				if (names[0].length == 1) {
					return names[0][0];
				} else {
					return names[0][0] + names[0][1];
				}
			} else {
				return names[0][0] + names[names.length - 1][0];
			}
		}

		function endsWith(text, value) { //does the text end with value?
			if (!text || !value) {
				return false;
			}
			if (text.length >= value.length) {
				return text.substring(text.length - value.length) == value;
			}
			return false;
		}

		function getName() { return "Stonetools Ltd | "+_("Precisely What You Need").translate(); }

		function getTitle(title) { return _(title).translate() + " | " + this.getName(); }

		function getSiteCode() {
		var host=SC.ENVIRONMENT.currentHost; 
switch(host){
case "stonetools-fr.bluebridgeone.com":
case "www.stonetools.fr":
case "stonetools.fr":
return "FR";
case "stonetools-ie.bluebridgeone.com":
case "www.stonetools.ie":
case "stonetools.ie":
return "IE";
}
return "UK";
		}

		function encodeDQString(value) {

			if (value) {
				return value.split("\"").join("\\\"");
			}
			return value;
		}

		function getSEO(details) { //Get SEO meta tags based on details object

			var meta = "";
			if (details.summary) {
				meta += "<meta name=\"twitter:card\" content=\"" + encodeDQString(_(details.title).translate()) + "\">\r\n";
			}
			if (details.twitter) {
				meta += "<meta name=\"twitter:site\" content=\"@" + details.twitter + "\">\r\n";
				meta += "<meta name=\"twitter:title\" content=\"" + encodeDQString(_(details.title).translate()) + "\">\r\n";
				if (details.summary) {
					meta += "<meta name=\"twitter:description\" content=\"" + encodeDQString(details.summary) + "\">\r\n";
				}
				//meta+="<meta name=\"twitter:creator\" content=\"@author_handle\">\r\n";
				if (details.image) {
					meta += "<meta name=\"twitter:image\" content=\"" + encodeDQString(details.image) + "\">\r\n";
				}
			}

			meta += "<meta property=\"og:title\" content=\"" + encodeDQString(_(details.title).translate()) + "\" />\r\n";
			meta += "<meta property=\"og:type\" content=\"" + encodeDQString(details.type || _("article").translate()) + "\" />\r\n";
			meta += "<meta property=\"og:url\" content=\"" + SC.ENVIRONMENT.currentHostString + "\" />\r\n";
			if (details.image) {
				meta += "<meta property=\"og:image\" content=\"" + encodeDQString(details.image) + "\" />\r\n";
			}
			if (details.summary) {
				meta += "<meta property=\"og:description\" content=\"" + encodeDQString(_(details.summary).translate()) + "\" />\r\n";
			}
			meta += "<meta property=\"og:site_name\" content=\"" + Tools.getName() + "\" />\r\n";
			//meta+="<meta property=\"fb:admins\" content=\"Facebook numeric ID\" />\r\n";
			return meta;

		}

		// Make Tools module available globally
		var Tools = SC.Tools = {
			endsWith: endsWith,
			getSEO: getSEO,
			getName: getName,
			getTitle: getTitle,
			getInitials: getInitials,
			trim:trim,
			getSiteCode:getSiteCode
		}
		return Tools;
	});